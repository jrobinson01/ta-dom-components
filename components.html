<!doctype html>
<html lang="en">
  <head>
    <title>ta-dom components</title>
    <!-- <script src="https://cdn.rawgit.com/jrobinson01/ta-dom/master/dist/ta-dom.min.js"></script> -->
    <script src="http://localhost:8081/lib/ta-dom.js"></script>
    <script src="./node_modules/morphdom/dist/morphdom-umd.js"></script>
  </head>
  <style>
    html, body {
      font-family: sans-serif;
    }
  </style>
  <body>
    <link rel="import" href="./TaDomElement.html">
    <script>
      class MyThirdElement extends TaDomElement {
        static get css() {
          return `
            :host{
              color: pink;
            }
          `
        }
        static get observedAttributes() {
          return ['name'];
        }
        static get properties() {
          return {
            name:{
              value:'third'
            }
          }
        }
        render() {
          return div({}, `my third element, ${this.name}`, slot());
        }
      }
      customElements.define('my-third-element', MyThirdElement);

      // create a function so others can use my-third-element in their templates
      const myThirdElement = generate('my-third-element');
    </script>
    <script>
      class MyElement extends TaDomElement {

        static get css() {
          return `
          :host {
            font-size: 24px;
            color: green;
          }
          .time {
            color: red;
          }
          `
        }

        static get observedAttributes() {
          return ['name'];
        }

        static get properties() {
          return {
            name: {
              value: 'bob',
              reflectToAttribute: true
            },
            time: {
              value: function(){
                return new Date().toLocaleString('en-US', {hour:'numeric', minute:'numeric', second:'numeric'});
              }
            },
            greeting: {
              value: 'hello, stranger.',
              computed: function(name) {
                return `hello, ${name}!`;
              }
            },
            items: {
              value: ['c','b','a']
            }
          }
        }

        connectedCallback() {
          this.timer = setInterval(() => {
            this.setState({time:this.time});
          }, 1000);
        }

        disconnectedCallback() {
          clearInterval(this.timer);
        }

        onClick(event) {
          console.log('click!', this.name);
          const rn = Math.round(Math.random() * 100);
          this.items.push(rn);
          this.items.sort();
          this.setState({items: this.items});
        }

        render() {
          const list = items => items.map(i => span({class:"num-display"}, `${i}, `));
          const el = div({class:'outer'},
              h1({},`${this.greeting}`),
              div({'class':'time','on-click':event => this.onClick(event)}, `the time is: ${this.time}`),
            list(this.items),
            slot());
          return el;
        }

      };
      customElements.define('my-element', MyElement);
      const myElement = generate('my-element');
    </script>
    <script>

    class MyOtherElement extends TaDomElement {

      static get observedAttributes() {
        return ['name'];
      }
      static get properties() {
        return {
          name:{
            value:'bob'
          }
        }
      }
      render() {
        return div({}, `other element, ${this.name}`,
          myThirdElement({
            'on-name-changed':(event)=> console.log('got name change:', event.detail)
          }, 'hello?'
        ));
      }
    }
    customElements.define('my-other-element', MyOtherElement);
    </script>
    <my-element name="Frank">
      <my-other-element name="test"></my-other-element>
    </my-element>
    <my-element name="not frank"></my-element>
  </body>
</html>
